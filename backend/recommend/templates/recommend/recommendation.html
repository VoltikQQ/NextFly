{% load shop_tags %}
{% load static %}
<div class="container my-1 py-1">
<div class="row d-flex justify-content-center">
  <div class="col-md-12 col-lg-10 col-xl-8">
    {% if user.get_username %}
    <form action="{% url 'recommend:add_review' item.pk %}" method="post" class="row g-3" id="formReview">
      {% csrf_token %}
      <div class="mb-1">
        <label class="form-label"><h5>Write a Review:</h5></label>
        <textarea class="form-control" id="contactcomment1" rows="3" name="text" required=""></textarea>
        <div class="rate">
          <input type="radio" name="rating" id="star5" value="5" checked/>
          <label class="star" for="star5" aria-hidden="true"></label>
          <input type="radio" name="rating" id="star4" value="4" />
          <label class="star" for="star4" aria-hidden="true"></label>
          <input type="radio" name="rating" id="star3" value="3" />
          <label class="star" for="star3" aria-hidden="true"></label>
          <input type="radio" name="rating" id="star2" value="2" />
          <label class="star" for="star2" aria-hidden="true"></label>
          <input type="radio" name="rating" id="star1" value="1" />
          <label class="star" for="star1" aria-hidden="true"></label>
        </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary">Send Review</button>
      </div>
      <div class="col">
        <input type="hidden" class="form-control" aria-label="First name" name="user" readonly value="{{ user.id }}">
      </div>
    </form>
    {% else %}
      <p><h4 class="text-center"><a href="{% url 'users:login' %}">Log in</a> to your account to leave a review</h4></p>
    {% endif %}
  </div>
</div>
</div>

<section class="gradient-custom">
  <div class="container my-1 py-1">
    <div class="row d-flex justify-content-left" style="display: flex; justify-content: center; align-items: center;">
      <div class="col-md-12 col-lg-10 col-xl-8">
        <div class="card">
          <div class="card-body p-4">
            <h4 class="text-center mb-4 pb-2">Reviews</h4>
            {% for reviews in item.get_review %}
              <div class="row">
                <div class="col">
                  <div class="d-flex flex-start">
                    <img class="rounded-circle shadow-1-strong"
                      src="{% static 'recommend/images/77086a4ce9dcc164c77db76c7853f012.jpg' %}" alt="avatar"
                      width="40" height="40" />
                    <div class="flex-grow-1 flex-shrink-1">
                      <div>
                        <div class="d-flex justify-content-between align-items-center">
                          <p class="mb-1 d-flex align-items-center">
                            {{reviews.user}} <span class="small ms-2">- {{reviews.time_create|date:"F d, Y"}}</span>
                          </p>
                          <div>
                            {% if user.get_username %}
                              <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#modal" onclick="addReview('{{ reviews.id }}')">
                                Reply
                              </button>
                            {% endif %}
                            {% if reviews.user == user %}
                              <form action="{% url 'recommend:delete_review' item_id=item.pk review_id=reviews.pk %}" method="POST" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">Delete</button>
                              </form>
                            {% endif %}
                          </div>
                        </div>
                        <p class="small mb-0">{{reviews.text}}</p>
                      </div>
                      {% for rew in reviews.get_review %}
                        <div class="d-flex flex-start mt-4">
                          <a class="me-3" href="#">
                            <img class="rounded-circle shadow-1-strong"
                              src="{% static 'recommend/images/77086a4ce9dcc164c77db76c7853f012.jpg' %}" alt="avatar"
                              width="30" height="30" />
                          </a>
                          <div class="flex-grow-1 flex-shrink-1">
                            <div>
                              <div class="d-flex justify-content-between align-items-center">
                                <p class="mb-1">
                                  {{rew.user}} <span class="small">- {{rew.time_create|date:"F d, Y"}}</span>
                                </p>
                                {% if rew.user == user %}
                                  <form action="{% url 'recommend:delete_review' item_id=item.pk review_id=rew.pk %}" method="POST" class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger">Delete</button>
                                  </form>
                                {% endif %}
                              </div>
                              <p class="small mb-0">{{rew.text}}</p>
                            </div>
                          </div>
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
              {% for i in 5|times %}
                {% if i < reviews.rating %}
                  <span class="fa fa-star checked"></span>
                {% else %}
                  <span class="fa fa-star"></span>
                {% endif %}
              {% endfor %}
              {% if not forloop.last %}
                <hr align="center" width="100%" size="5" color="#dddddd"/>
              {% endif %}
              {% empty %}
              <h6 class="text-center">There are no reviews here yet</h6>
            {% endfor %}
          </div>
      </div>
    </div>
  </div>
</div>
</section>

<form action="{% url 'recommend:add_review' item.pk %}" method="post" class="row g-3">
  {% csrf_token %}
  <div class="modal fade" id="modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" >
      <div class="modal-content">
        <div class="container">
         <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Send reply</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <input type="hidden" name="parent" id="contactparent" value="">
          <div class="mb-3">
            <textarea class="form-control" id="contactcomment" rows="8" name="text"></textarea>
          </div>
          <div class="col">
            <input type="hidden" class="form-control" aria-label="First name" name="user" readonly value="{{ user.id }}">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Send</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>

<script>
    function addReview(id) {
        document.getElementById("contactparent").value = id;
    }
</script>